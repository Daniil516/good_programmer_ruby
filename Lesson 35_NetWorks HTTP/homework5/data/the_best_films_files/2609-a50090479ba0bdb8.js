"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2609],{64693:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0});var i=t(34267);i.__exportStar(t(33148),n),i.__exportStar(t(11440),n)},96769:function(e,n){Object.defineProperty(n,"__esModule",{value:!0})},92716:function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.Environment=void 0,function(e){e.Development="development",e.Qa="qa",e.Testing="testing",e.Stress="stress",e.Prestable="prestable",e.Production="production"}(n.Environment||(n.Environment={}))},33148:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0});var i=t(34267);i.__exportStar(t(96769),n),i.__exportStar(t(92716),n)},64363:function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.coerceBoolean=void 0,n.coerceBoolean=function(e){return"true"===e}},80007:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),n.coerceEnvironment=void 0;var i=t(33148);n.coerceEnvironment=function(e){return Object.values(i.Environment).includes(e)?e:i.Environment.Production}},94218:function(e,n,t){var i=t(52654);Object.defineProperty(n,"__esModule",{value:!0}),n.envConfig=void 0,n.envConfig=function(e,n,t){if(void 0===t&&(t={}),void 0===e)throw new Error("name is required");if(void 0===n)throw new Error("defaultValue is required");var o=i.env[e];return o?(null===t||void 0===t?void 0:t.coerce)?t.coerce(o):o:n}},11440:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0});var i=t(34267);i.__exportStar(t(64363),n),i.__exportStar(t(80007),n),i.__exportStar(t(94218),n)},2896:function(e,n,t){t.d(n,{xe:function(){return s},FG:function(){return c},HC:function(){return p}});var i=t(37667),o=t.n(i),r=t(12583),a=t(13944);function s(){const e=(0,r.useDispatch)();o().useEffect((()=>{e((0,a.EF)())}),[])}var d=t(9516),l=t(45817),u=t(62916);function c({isDisabled:e,customListener:n,config:t}){(0,i.useEffect)((()=>{const i=(0,l.b)()||(e=>{const n=(0,u.w)(e)||void 0;return window.Ya=window.Ya||{},window.Ya.Kinopoisk=window.Ya.Kinopoisk||{},window.Ya.Kinopoisk.MDA=n,n})(t);!i||i.isMdaInitialized||e||i.init({listener(e){n&&n(e.type),e.type===d.Q.ChangedProfile&&window.location.reload()}})}),[])}const p=()=>(0,i.useCallback)((()=>{if(!window)return;const e=(0,l.b)();null!==e&&void 0!==e&&e.isMdaInitialized&&e.syncCookie()}),[])},62916:function(e,n,t){t.d(n,{w:function(){return w}});var i=t(73696),o=t(77529),r=t(9516);function a({mdaSdkRoot:e,baseHost:n,retPath:t}){const i=function(e,n){return`${e}/api/profile-pending/?retpath=${encodeURIComponent(n)}`}(n,t);return`https://${e}/push?retpath=${encodeURIComponent(i)}&uuid=${(0,o.Z)()}`}const s=localStorage.getItem("kp-mda-debug");function d(...e){s&&console.log(...e)}function l(e){const n=new RegExp(`(?:(?:^|.*;\\s*)${e}\\s*=\\s*([^;]*).*$)|^.*$`);return window.document.cookie.replace(n,"$1")}function u(e){if(!e.ok){const{status:n,statusText:t}=e;throw new Error([n,t].filter(Boolean).join(" "))}return e.json()}function c(e,n){return`${n}/get-yapic/${e}/islands-200`}function p({default_avatar:e,firstname:n,lastname:t,name:i,social:o},r){return{defaultAvatar:e,firstName:n,lastName:t,name:i,defaultAvatarUrl:c(e,r),social:o}}function f({accounts:e,"can-add-more":n,default_uid:t},i){return{accounts:e&&e.map((e=>function({attributes:e,defaultEmail:n,displayName:t,login:i,uid:o},r){return{attributes:e,defaultEmail:n,displayName:t&&p(t,r),login:i,uid:o}}(e,i))),canAddMore:n,defaultUid:t}}let m;function v(e){return fetch(`${e}/api/mda-status/`,{credentials:"include"}).then((e=>e.json()))}!function(e){e.valid="VALID",e.invalid="INVALID",e.needReset="NEED_RESET",e.noAuth="NO_AUTH",e.disabled="DISABLED"}(m||(m={}));var h=t(68521);function k({mdaSdkRoot:e,baseHost:n,retPath:t}){const i=`${n}/api/profile-pending/?retpath=${encodeURIComponent(t)}`;return`https://${e}/push?${h.stringify({retpath:i,uuid:(0,o.Z)()})}`}function g(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function b(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?g(Object(t),!0).forEach((function(n){(0,i.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}class y{constructor(e){(0,i.Z)(this,"config",void 0),(0,i.Z)(this,"resolveUserId",void 0),(0,i.Z)(this,"userId",void 0),(0,i.Z)(this,"isInitialized",void 0),this.isInitialized=!1,this.config=e,this.resolveUserId=()=>{},this.userId=new Promise((e=>{this.resolveUserId=e}))}get isMdaInitialized(){return this.isInitialized}init(e={}){d("library init"),this.isInitialized=!1,this.config=b(b({},this.config),e);const{baseHost:n,mdaSdkRoot:t,mdaSdkSso:i,scriptUrl:a}=this.config;var s;Promise.all([v(n),(s=a,new Promise(((e,n)=>{const t=document.createElement("script");t.async=!0,t.src=s,t.addEventListener("load",e),t.addEventListener("error",(()=>n("ERROR"))),t.addEventListener("abort",(()=>n("ABORT"))),document.head.appendChild(t)})))]).then((([e])=>{d("kp:mda Initializing SDK",e),this.config.listener.call(null,{type:r.Q.LibraryInitializing}),window.MDA2.init({sso:i,root:t,listener:n=>this.handleSdkEvent(n,e),uuid:(0,o.Z)()}),this.isInitialized=!0,this.syncCookie()})).catch((e=>{d("kp:mda MDA initialization error",e),this.config.listener.call(null,{type:r.Q.InitializationError,error:e}),this.resolveUserId(null),this.isInitialized=!1}))}getLoginUrl(e){const n=this.buildRetPathToLocation(e||window.location.href);return`${this.config.passportUrl}/auth?origin=kinopoisk&retpath=${encodeURIComponent(n)}`}getLogoutUrl(e){const n=this.buildRetPathToLocation(e||window.location.origin);return`${this.config.passportUrl}/passport?mode=logout&yu=${encodeURIComponent(l("yandexuid"))}&retpath=${encodeURIComponent(n)}`}getAddMultiAccountUrl(e=window.location.href){const{mdaSdkRoot:n,baseHost:t,passportUrl:i}=this.config;return function({mdaSdkRoot:e,baseHost:n,passportUrl:t,retPath:i}){const o=k({mdaSdkRoot:e,baseHost:n,retPath:i});return`${t}/auth/add?${h.stringify({mode:"add-user",retpath:o,origin:"kinopoisk"})}`}({mdaSdkRoot:n,baseHost:t,passportUrl:i,retPath:e})}getChangeMultiAccountUrl(e,n=window.location.href){const{mdaSdkRoot:t,baseHost:i,passportUrl:o}=this.config;return function({mdaSdkRoot:e,baseHost:n,passportUrl:t,uid:i,retPath:o}){const r=k({mdaSdkRoot:e,baseHost:n,retPath:o});return`${t}/passport?${h.stringify({mode:"embeddedauth",yu:l("yandexuid"),action:"change_default",uid:i,retpath:r,origin:"kinopoisk"})}`}({mdaSdkRoot:t,baseHost:i,passportUrl:o,uid:e,retPath:n})}getLogoutMultiAccountUrl(e,n=window.location.href){const{mdaSdkRoot:t,baseHost:i,passportUrl:o}=this.config;return function({mdaSdkRoot:e,baseHost:n,passportUrl:t,uid:i,retPath:o}){const r=k({mdaSdkRoot:e,baseHost:n,retPath:o});return`${t}/passport?${h.stringify({mode:"embeddedauth",yu:l("yandexuid"),action:"logout",uid:i,retpath:r,origin:"kinopoisk"})}`}({mdaSdkRoot:t,baseHost:i,passportUrl:o,uid:e,retPath:n})}syncCookie(){this.isMdaInitialized&&(d("kp:mda Syncing cookie with SDK"),this.config.listener.call(null,{type:r.Q.SyncingCookie}),window.MDA2.sync())}fetchAccounts(){const{passportApiUrl:e,mdsHost:n}=this.config;return this.userId.then((t=>t?function(e,n){return fetch(`${e}/all_accounts/`,{credentials:"include"}).then(u).then((e=>f(e,n)))}(e,n):{}))}handleSdkEvent(e,{sessionStatus:n,userId:t}){switch(d("kp:mda Receiving event from SDK",e),this.config.listener.call(null,{type:r.Q.ResponseReceived}),e.status){case"blocked":if(this.config.listener.call(null,{type:r.Q.Blocked}),-1!==[m.valid,m.noAuth,m.invalid,m.disabled].indexOf(n))return void this.resolveUserId(t);if(window.location.search.includes("sso_failed")||window.location.hash.includes("sso_failed"))return void this.resolveUserId(t);this.config.listener.call(null,{type:r.Q.StartRedirect}),this.config.isRedirectDisabled||(o=200,new Promise((e=>{setTimeout(e,o)}))).then((()=>{window.location.replace(this.buildRetPathToLocation(window.location.href))}));break;case"synchronized":this.config.listener.call(null,{type:r.Q.Synchronized}),(i=this.config.baseHost,fetch(`${i}/api/profile/`,{method:"POST",credentials:"include"}).then((e=>e.json()))).then((({kp1UserId:e=null})=>(e!==t?(d("kp:mda Profile has been changed"),this.config.listener.call(null,{type:r.Q.ChangedProfile,kpId:e}),this.resolveUserId(e)):(d("kp:mda Profile are still the same"),this.config.listener.call(null,{type:r.Q.NotChangedProfile}),this.resolveUserId(t)),null))).catch((()=>this.resolveUserId(t)));break;case"inprogress":this.config.listener.call(null,{type:r.Q.InProgress}),this.resolveUserId(t);break;case"failed":this.config.listener.call(null,{type:r.Q.Failed}),this.resolveUserId(t);break;default:this.resolveUserId(t)}var i,o}buildRetPathToLocation(e){return a({mdaSdkRoot:this.config.mdaSdkRoot,baseHost:this.config.baseHost,retPath:e})}}let S=null;const w=e=>(S=S||new y(e),S)},45866:function(e,n,t){t.d(n,{Hw:function(){return m},_L:function(){return d}});const i="page";var o=t(99886),r=t(73696),a=t(92286);let s;!function(e){e.SetQuery="page/SET_QUERY"}(s||(s={}));const d=(0,a.PH)(s.SetQuery);function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function u(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}const c={};const p={[s.SetQuery]:function(e=c,{payload:n}){return u(u({},e),n)}};const f=(0,o.combineReducers)({query:function(e=c,n){return n.type in p?p[n.type](e,n):e}});function m(){return{id:"page",reducerMap:{[i]:f}}}(0,t(46942).P1)((({[i]:e})=>e),(({query:e})=>e))},94257:function(e,n,t){t.d(n,{c:function(){return a}});var i=t(46942),o=t(3064);const r=(0,i.P1)(o.R,(({featureToggle:e})=>e)),a=(e,{featureId:n})=>{const t=r(e);return Boolean(t[n])}},9516:function(e,n,t){let i;t.d(n,{Q:function(){return i}}),function(e){e.InitializationError="initialization_error",e.ChangedProfile="changed_profile",e.NotChangedProfile="not_changed_profile",e.Synchronized="synchronized",e.Blocked="blocked",e.InProgress="in_progress",e.Failed="failed",e.LibraryInitializing="library_initializing",e.StartRedirect="start_redirect",e.ResponseReceived="response_received",e.SyncingCookie="syncing_cookie"}(i||(i={}))},69334:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),t(34267).__exportStar(t(39634),n)},39634:function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),n.withDynamicModules=void 0;var i=t(34267),o=i.__importDefault(t(37667)),r=t(35997);n.withDynamicModules=function(e){return function(n){var t=function(t){return o.default.createElement(r.DynamicModuleLoader,{modules:e},o.default.createElement(n,i.__assign({},t)))};t.getInitialProps=function(t){return i.__awaiter(void 0,void 0,void 0,(function(){var o;return i.__generator(this,(function(i){switch(i.label){case 0:return t.store.addModules(e),n.getInitialProps?[4,n.getInitialProps(t)]:[3,2];case 1:return o=i.sent(),[3,3];case 2:o={},i.label=3;case 3:return[2,o]}}))}))};var a=n.displayName||n.name||"Component";return t.displayName="withDynamicModules("+a+")",t}}},44092:function(e,n,t){t.d(n,{j:function(){return i}});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"PageData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"_local"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"page"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"supportedPlatforms"}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}}]}},570:function(e,n,t){let i;t.d(n,{A:function(){return i}}),function(e){e.Touch="TOUCH",e.Desktop="DESKTOP"}(i||(i={}))},31010:function(e,n,t){t.d(n,{a:function(){return i}});const i=e=>n=>e(n)},65089:function(e,n,t){t.d(n,{Vo:function(){return i},vw:function(){return o},pG:function(){return r},V:function(){return a}});const i=t(570).A.Desktop,o="Safari",r="MobileSafari",a="Firefox"},29232:function(e,n,t){t.d(n,{r:function(){return s}});var i=t(44092);var o=t(570),r=t(65089),a=t(68049);function s(e){const n=(0,a.S)(e),t=function(e){var n,t,o;const r=e.readQuery({query:i.j});return null!==(n=null===r||void 0===r||null===(t=r._local)||void 0===t||null===(o=t.page)||void 0===o?void 0:o.supportedPlatforms)&&void 0!==n?n:null}(e);return null!==n&&void 0!==n&&n.prevailingPlatform?null===n||void 0===n?void 0:n.prevailingPlatform:null!==n&&void 0!==n&&n.isMobile&&!n.isTablet&&null!==t&&void 0!==t&&t.includes(o.A.Touch)?o.A.Touch:null===t||void 0===t||!t.includes(o.A.Desktop)||null!==n&&void 0!==n&&n.isMobile&&!n.isTablet?null!==t&&void 0!==t&&t.length&&!t.includes(r.Vo)?t[0]:r.Vo:o.A.Desktop}},68049:function(e,n,t){t.d(n,{S:function(){return o}});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"UserPlatform"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"_local"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPlatform"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isTouch"}},{kind:"Field",name:{kind:"Name",value:"isMobile"}},{kind:"Field",name:{kind:"Name",value:"isTablet"}},{kind:"Field",name:{kind:"Name",value:"isBrowser"}},{kind:"Field",name:{kind:"Name",value:"postMessageSupport"}},{kind:"Field",name:{kind:"Name",value:"historySupport"}},{kind:"Field",name:{kind:"Name",value:"webPSupport"}},{kind:"Field",name:{kind:"Name",value:"svgSupport"}},{kind:"Field",name:{kind:"Name",value:"yaGui"}},{kind:"Field",name:{kind:"Name",value:"osVersion"}},{kind:"Field",name:{kind:"Name",value:"osName"}},{kind:"Field",name:{kind:"Name",value:"browserBaseVersion"}},{kind:"Field",name:{kind:"Name",value:"browserEngine"}},{kind:"Field",name:{kind:"Name",value:"osFamily"}},{kind:"Field",name:{kind:"Name",value:"browserEngineVersion"}},{kind:"Field",name:{kind:"Name",value:"browserVersion"}},{kind:"Field",name:{kind:"Name",value:"browserName"}},{kind:"Field",name:{kind:"Name",value:"csp1Support"}},{kind:"Field",name:{kind:"Name",value:"localStorageSupport"}},{kind:"Field",name:{kind:"Name",value:"browserBase"}},{kind:"Field",name:{kind:"Name",value:"csp2Support"}},{kind:"Field",name:{kind:"Name",value:"isRobot"}},{kind:"Field",name:{kind:"Name",value:"isSmartphone"}},{kind:"Field",name:{kind:"Name",value:"isSmartTv"}},{kind:"Field",name:{kind:"Name",value:"isPlayStation"}},{kind:"Field",name:{kind:"Name",value:"prevailingPlatform"}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}}]};function o(e){var n,t;const o=e.readQuery({query:i});return null!==(n=null===o||void 0===o||null===(t=o._local)||void 0===t?void 0:t.userPlatform)&&void 0!==n?n:null}},92385:function(e,n,t){t.d(n,{a:function(){return a}});var i=t(570),o=t(23737),r=t(29232);function a(){return function(){const e=(0,o.useApolloClient)();return(0,r.r)(e)}()===i.A.Desktop}},8806:function(e,n,t){t.d(n,{D:function(){return a}});var i=t(23737),o=t(68049),r=t(65089);const a=()=>{const e=(0,i.useApolloClient)(),n=(0,o.S)(e);return(null===n||void 0===n?void 0:n.browserName)===r.V}},50222:function(e,n,t){t.d(n,{b:function(){return i}});const i=e=>n=>e(n)},35831:function(e,n,t){t.d(n,{u:function(){return i}});const i="server_sso_redirect"},15586:function(e,n,t){t.d(n,{l:function(){return _}});var i=t(73696),o=t(76888),r=t(2896),a=t(64693);t(62916);const s={passportUrl:"https://passport.yandex.ru",passportApiUrl:"https://api.passport.yandex.ru",mdsHost:"https://avatars.mds.yandex.net",scriptUrl:"https://sso.kinopoisk.ru/js/v1/mda2.1.min.js",mdaSdkSso:"sso.kinopoisk.ru",mdaSdkRoot:"sso.passport.yandex.ru",baseHost:"https://www.kinopoisk.ru"},d={passportUrl:"https://passport-test.yandex.ru",passportApiUrl:"https://api.passport-test.yandex.ru",mdsHost:"https://avatars.mdst.yandex.net",scriptUrl:"https://sso.testing.kinopoisk.ru/js/v1/mda2.1.min.js",mdaSdkSso:"sso.testing.kinopoisk.ru",mdaSdkRoot:"sso.passport-test.yandex.ru",baseHost:"https://testing.kinopoisk.ru"};var l=t(55222);function u(e){(0,l.s)(`mda-library.${e}`)}var c=t(12583),p=t(94257),f=t(54772),m=t(35831),v=t(23737),h=t(68049),k=t(65089);var g=t(8806);function b(){const e=(0,c.useSelector)((e=>(0,p.c)(e,{featureId:m.u}))),n=(0,c.useSelector)(f.fN),t=function(){const e=(0,v.useApolloClient)(),n=(0,h.S)(e);return Boolean((null===n||void 0===n?void 0:n.browserName)&&[k.vw,k.pG].includes(n.browserName))}(),i=(0,g.D)();return e&&n&&(t||i)}function y(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function S(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?y(Object(t),!0).forEach((function(n){(0,i.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}const{publicRuntimeConfig:{environment:w}}=(0,o.default)(),P=[a.Environment.Production,a.Environment.Prestable],_=()=>{const e=b();(0,r.FG)({config:S(S({},P.includes(w)?s:d),{},{listener(){}}),customListener:u,isDisabled:e})}}}]);
//# sourceMappingURL=https://kinopoisk-frontend-internal.s3.mds.yandex.net/frontend-www/release/_next/static/chunks/2609-a50090479ba0bdb8.js.map